import s from"./imports/change-addon-state.js"
import{getMissingOptionalPermissions as o}from"./imports/util.js"
const e=s=>{chrome.permissions.contains({origins:chrome.runtime.getManifest().permissions.filter((s=>s.startsWith("https://")))},(o=>{o||(console.error("Site access is not granted."),chrome.tabs.create({active:1,url:"/webpages/settings/permissions.html"})),s(o)}))},i=()=>{o().then((o=>{scratchAddons.manifests.forEach((({addonId:e,manifest:i})=>{scratchAddons.localState.addonsEnabled[e]&&i.permissions?.some((s=>o.includes(s)))&&(console.warn("Disabled addon",e,"due to missing optional permission"),s(e,0))}))}))}
chrome.runtime.onMessage.addListener(((s,o,i)=>{if("checkPermissions"===s)return e(i),1})),chrome.permissions.onRemoved?.addListener((()=>{e((()=>{})),i()})),e((()=>{})),i()
