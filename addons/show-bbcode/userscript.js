function t(t,o){return function(s){s.preventDefault()
const e=t.querySelector(".postmsg")
if("post"===s.target.getAttribute("data-state")){s.target.innerText=o("source-button-active"),s.target.removeAttribute("title"),void 0===s.target.originalHTML&&(s.target.originalHTML=e.firstElementChild),e.removeChild(e.firstElementChild)
const a=document.createElement("div")
if(e.insertBefore(a,e.firstElementChild),a.className="post_body_html",void 0!==s.target.sourceText)return s.target.setAttribute("data-state","source"),void(a.innerText=s.target.sourceText)
s.target.setAttribute("data-state","loading"),a.innerText=o("loading"),fetch("https://scratch.mit.edu/discuss/post/"+t.id.substring(1)+"/source/").then((function(t){t.text().then((function(t){s.target.setAttribute("data-state","source"),a.innerText=s.target.sourceText=t}))}))}else"source"===s.target.getAttribute("data-state")&&(s.target.innerText=o("source-button"),s.target.title=o("source-button-tooltip"),s.target.setAttribute("data-state","post"),e.removeChild(e.firstElementChild),e.insertBefore(s.target.originalHTML,e.firstElementChild))}}export default async function({addon:o,msg:s}){for(;;){const e=await o.tab.waitForElement(".blockpost",{markAsSeen:1}),a=document.createElement("li")
o.tab.displayNoneWhileDisabled(a),o.tab.appendToSharedSpace({space:"forumsAfterPostReport",scope:e,element:a,order:0})
const c=document.createElement("a")
a.appendChild(c),a.appendChild(document.createTextNode(" ")),c.href="#",c.innerText=s("source-button"),c.title=s("source-button-tooltip"),c.setAttribute("data-state","post"),c.addEventListener("click",t(e,s))}}